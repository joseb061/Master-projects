---
title: "Last proyect"
author: "Joseba"
date: "11/1/2022"
output:
  rmdformats::downcute:
    self_contained: true
    thumbnails: true
    lightbox: true
    gallery: false
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(combinat)
library(GGally)
```
```{r}
# df <- read.csv(file ='/home/joseba/Master/Master-git/DataVis/Resampling Methods/proyecto/data_waves/first/madrid_first.csv')
# casos <- df$num_casos
# temperatura <- df$tmed
# precip <- df$prec
```

We are going to use Spearman
tests.

The main reason for using non-parametric statistical
tests is that compared with parametric statistical tests, are thought
to be more suitable for non- normally distributed data, which are
frequently involved in time serises air pollution and climate vari-
ables. In order to use no-parametric rank correlation Spearman
tests, were applied the Kolmogorov-Smirnov Tests of Normality
for time-series data sets, that provided very good evidence that the
considered time-series data were not normally distributed.


The null hypothesis of the K-S test is that the distribution is normal.
Therefore, if p-value of the test is >0.05, we do not reject the null hypothesis and conclude that the distribution in question is not statistically different from a normal distribution.

```{r}
# statistical_column <- c("num_casos","tmed","wind","prec")

# print (ks.test(df$num_casos, "pnorm", mean=mean(df$num_casos), sd=sd(df$num_casos)))
# print (ks.test(df$tmed, "pnorm", mean=mean(df$tmed), sd=sd(df$tmed)))
# print (ks.test(df$wind, "pnorm", mean=mean(df$wind), sd=sd(df$wind)))
# print (ks.test(df$prec, "pnorm", mean=mean(df$prec), sd=sd(df$prec)))

provinces <- c('alava', 'albacete', 'alicante', 'almeria', 'asturias', 'avila',
       'badajoz', 'baleares', 'barcelona', 'bizkaia', 'burgos', 'caceres',
       'cadiz', 'cantabria', 'castellon', 'ceuta', 'ciudadReal', 'cordoba',
       'coruña', 'cuenca', 'gipuzkoa', 'girona', 'granada', 'guadalajara',
       'huelva', 'huesca', 'jaen', 'laRioja', 'lasPalmas', 'leon', 'lleida',
       'lugo', 'madrid', 'malaga', 'melilla', 'murcia', 'navarra', 'ourense',
       'palencia', 'pontevedra', 'salamanca', 'santaCruzDeTenerife', 'segovia',
       'sevilla', 'soria', 'tarragona', 'teruel', 'toledo', 'valencia',
       'valladolid', 'zamora', 'zaragoza')
waves <- c("first","second","third","fourth","fifth")
path0 <- "/home/joseba/Master/Master-git/DataVis/Resampling Methods/proyecto/data_waves"

provincias_vec <- c()
wave_vec <- c()
D_vec <- c()
p_value_vec <- c()


for (wave in waves){
  path <- paste0(path0,"/",wave)
  for (province in provinces){
    path <- paste0(path,"/",province,"_",wave,".csv")
    df <- read.csv(file = path)
    
    casos <- df$num_casos
    temperatura <- df$tmed
    precip <- df$prec
    

    ks.test(casos, "pnorm", mean=mean(casos), sd=sd(casos))
    ks.test(temperatura, "pnorm", mean=mean(temperatura), sd=sd(temperatura))
    ks.test(precip, "pnorm", mean=mean(precip), sd=sd(precip))
    


    # sttrue= cor.test(casos,temperatura, method = "spearman", exact=FALSE)
    # path <- paste0(path0,"/",wave)
    
    # #fill vectors
    # provincias_vec <- append(provincias_vec, province, after = length(provincias_vec))
    # wave_vec<-append(wave_vec, wave, after = length(wave_vec))
    # correlation_vec<-append(correlation_vec, sttrue[[4]], after = length(correlation_vec))
    # p_value_vec<-append(p_value_vec, sttrue[[3]], after = length(p_value_vec))
    # temperature_vec <- append(temperature_vec, mean(temperatura), after= length(temperature_vec))
    
    }
}

# DataFrame.correlations <- data.frame(provincias_vec,wave_vec,
#                                      correlation_vec,p_value_vec,temperature_vec)   

```
Therefore, as the p-value for the S-K test is smaller than 0.05
in all the cases, we can reject the null hypothesis and therefore, we can conclude
that the  distribution in question is statistically different from a normal distribution.


Now we can calculate the spearman correlation test:

```{r cars}
sttrue= cor.test(casos,temperatura, method = "spearman", exact=FALSE)
#print(paste0("p-value: ",sttrue[3]," correlation: ",sttrue[4]))
print(sttrue[[4]])
```



```{r}
provinces <- c('alava', 'albacete', 'alicante', 'almeria', 'asturias', 'avila',
       'badajoz', 'baleares', 'barcelona', 'bizkaia', 'burgos', 'caceres',
       'cadiz', 'cantabria', 'castellon', 'ceuta', 'ciudadReal', 'cordoba',
       'coruña', 'cuenca', 'gipuzkoa', 'girona', 'granada', 'guadalajara',
       'huelva', 'huesca', 'jaen', 'laRioja', 'lasPalmas', 'leon', 'lleida',
       'lugo', 'madrid', 'malaga', 'melilla', 'murcia', 'navarra', 'ourense',
       'palencia', 'pontevedra', 'salamanca', 'santaCruzDeTenerife', 'segovia',
       'sevilla', 'soria', 'tarragona', 'teruel', 'toledo', 'valencia',
       'valladolid', 'zamora', 'zaragoza')
waves <- c("first","second","third","fourth","fifth")
path0 <- "/home/joseba/Master/Master-git/DataVis/Resampling Methods/proyecto/data_waves"


provincias_vec <- c()
wave_vec <- c()
correlation_vec <- c()
p_value_vec <- c()
temperature_vec <- c()

for (wave in waves){
  path <- paste0(path0,"/",wave)
  for (province in provinces){
    path <- paste0(path,"/",province,"_",wave,".csv")
    df <- read.csv(file = path)
    
    casos <- df$num_casos
    temperatura <- df$tmed
    precip <- df$prec
    
    sttrue= cor.test(casos,temperatura, method = "spearman", exact=FALSE)
    path <- paste0(path0,"/",wave)
    
    #fill vectors
    provincias_vec <- append(provincias_vec, province, after = length(provincias_vec))
    wave_vec<-append(wave_vec, wave, after = length(wave_vec))
    correlation_vec<-append(correlation_vec, sttrue[[4]], after = length(correlation_vec))
    p_value_vec<-append(p_value_vec, sttrue[[3]], after = length(p_value_vec))
    temperature_vec <- append(temperature_vec, mean(temperatura), after= length(temperature_vec))

    
    }
}

DataFrame.correlations <- data.frame(provincias_vec,wave_vec,
                                     correlation_vec,p_value_vec,temperature_vec)    

```

## Correlation matrix Plot

```{r pressure, echo=FALSE}
ggcorr(df, method = c("pairwise", "spearman"),
  nbreaks = NULL, digits = 2, low = "#3B9AB2",
  mid = "#EEEEEE", high = "#F21A00",
  geom = "tile", label = TRUE,
  label_alpha = FALSE)
```

```{r}
path <- '/home/joseba/Master/Master-git/DataVis/Resampling Methods/proyecto/data_waves/fourth/malaga_fourth.csv'
df <- read.csv(file = path)

casos <- df$num_casos
temperatura <- df$tmed
precip <- df$prec

fit1 <- lm(casos ~ temperatura, data = df)
summary(fit1)
```

```{r}
library(ggplot2)

ggplot(df, aes(x = temperatura, y = casos)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "blue")
```


